import{Q as y,k as j,l as C,n as P,o as I,r as s,a as f,u as b,h as k,j as e,C as m,p as E}from"./index-ByTeTk1v.js";import{t as S,a as D,g as M}from"./components-B0Y2GjJ0.js";var F=class extends y{constructor(t,a){super(t,a)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t){super.setOptions({...t,behavior:j()})}getOptimisticResult(t){return t.behavior=j(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,a){const{state:n}=t,o=super.createResult(t,a),{isFetching:c,isRefetching:i,isError:r,isRefetchError:u}=o,d=n.fetchMeta?.fetchMore?.direction,p=r&&d==="forward",l=c&&d==="forward",h=r&&d==="backward",x=c&&d==="backward";return{...o,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:P(a,n.data),hasPreviousPage:C(a,n.data),isFetchNextPageError:p,isFetchingNextPage:l,isFetchPreviousPageError:h,isFetchingPreviousPage:x,isRefetchError:u&&!p&&!h,isRefetching:i&&!l&&!x}}};function T(t,a){return I(t,F)}const z=t=>s.createElement("svg",{id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 200 200",enableBackground:"new 0 0 200 200",xmlSpace:"preserve",...t},s.createElement("path",{fill:"currentColor",d:"M119.032,145.698h-37.4c-6.2,0-11.3-5.1-11.3-11.3v-50.7c0-1.1,0.9-2,2-2h56c1.1,0,2,0.9,2,2v50.7 C130.332,140.598,125.232,145.698,119.032,145.698z M74.332,85.698v48.7c0,4,3.3,7.3,7.3,7.3h37.3c4,0,7.3-3.3,7.3-7.3v-48.7H74.332 z"}),s.createElement("path",{fill:"currentColor",d:"M138.332,73.598h-76c-1.1,0-2-0.9-2-2s0.9-2,2-2h76c1.1,0,2,0.9,2,2S139.432,73.598,138.332,73.598z"}),s.createElement("path",{fill:"currentColor",d:"M138.332,85.598h-76c-1.1,0-2-0.9-2-2s0.9-2,2-2h76c1.1,0,2,0.9,2,2S139.432,85.598,138.332,85.598z"}),s.createElement("path",{fill:"currentColor",d:"M112.332,73.698h-24c-1.1,0-2-0.9-2-2v-6c0-6.6,5.4-12,12-12h4c6.6,0,12,5.4,12,12v6 C114.332,72.798,113.432,73.698,112.332,73.698z M90.332,69.698h20v-4c0-4.4-3.6-8-8-8h-4c-4.4,0-8,3.6-8,8V69.698z"}),s.createElement("path",{fill:"currentColor",d:"M88.732,131.698c-1.1,0-2-0.9-2-2v-32c0-1.1,0.9-2,2-2c1.1,0,2,0.9,2,2v32 C90.732,130.798,89.832,131.698,88.732,131.698z"}),s.createElement("path",{fill:"currentColor",d:"M100.732,131.698c-1.1,0-2-0.9-2-2v-32c0-1.1,0.9-2,2-2c1.1,0,2,0.9,2,2v32 C102.732,130.798,101.832,131.698,100.732,131.698z"}),s.createElement("path",{fill:"currentColor",d:"M112.732,131.698c-1.1,0-2-0.9-2-2v-32c0-1.1,0.9-2,2-2c1.1,0,2,0.9,2,2v32 C114.732,130.798,113.832,131.698,112.732,131.698z"})),L=t=>s.createElement("svg",{id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 200 200",enableBackground:"new 0 0 200 200",xmlSpace:"preserve",...t},s.createElement("path",{fill:"currentColor",d:"M124.232,129.198c-0.3,0-0.601-0.1-0.901-0.2l-23.099-11.1l-23.1,11.1c-0.6,0.3-1.1,0.3-1.7-0.1 c-0.6-0.4-0.7-1-0.7-1.7v-56c0-1.1,0.5-2.1,1.6-2.1h47.999c1.1,0,2.401,1,2.401,2.1v56c0,0.7-0.6,1.3-1.1,1.7 C125.232,129.098,124.632,129.198,124.232,129.198z M100.232,113.698c0.3,0,0.8,0.1,1.1,0.2l21.4,10.1v-50.9h-44v50.9l20.9-10.1 C99.832,113.798,99.932,113.698,100.232,113.698z"}),s.createElement("path",{fill:"currentColor",d:"M100.232,158.198c-0.4,0-0.9-0.1-1.3-0.4l-24-19.5c-0.9-0.7-1-2-0.3-2.8c0.7-0.9,2-1,2.8-0.3l22.8,18.4 l22.7-19.4c0.8-0.7,2.1-0.6,2.8,0.2s0.599,2.1-0.2,2.8l-24,20.5C101.132,157.998,100.732,158.198,100.232,158.198z"}),s.createElement("path",{fill:"currentColor",d:"M110.232,149.098h-20c-1.1,0-2-0.9-2-2c0-1.1,0.9-2,2-2h20c1.099,0,2,0.9,2,2 C112.232,148.198,111.331,149.098,110.232,149.098z"}),s.createElement("path",{fill:"currentColor",d:"M100.632,107.198c-1.1,0-2-0.9-2-2v-32c0-1.1,0.9-2,2-2c1.1,0,2,0.9,2,2v32 C102.632,106.298,101.732,107.198,100.632,107.198z"}),s.createElement("path",{fill:"currentColor",d:"M124.232,65.198h-48c-1.1,0-2-0.9-2-2v-6.8c0-8.4,6.8-15.2,15.3-15.2h21.5c8.4,0,15.2,6.8,15.2,15.3v6.7 C126.232,64.298,125.331,65.198,124.232,65.198z M78.232,61.198h44v-4.8c0-6.2-5-11.2-11.2-11.2h-21.5c-6.3,0-11.3,5-11.3,11.3 V61.198z"}));function w({id:t}){const{changeDataById:a,getUserDataById:n}=f(),o=t?n(t):void 0,{open:c,close:i}=b(),[r,u]=s.useState({id:t??k(),date:o?o.date:new Date().toISOString(),title:o?o.title:"",amount:o?String(o.amount):"0",location:o?{lat:String(o.location?.lat??0),lng:String(o.location?.lng??0)}:{lat:"0",lng:"0"},isIncome:o?o.isIncome:!0}),d=l=>{try{l.preventDefault();const h=Number(r.amount.replace(",",".")),x=Number(r.location?.lat.replace(",",".")),g=Number(r.location?.lng.replace(",","."));if(isNaN(h)||isNaN(x)||isNaN(g))return;const v={id:r.id,title:r.title,amount:h,date:r.date,isIncome:r.isIncome,...x!==0&&g!==0?{location:{lat:x,lng:g}}:{}};t?(a(v.id,v),i(),setTimeout(()=>c("Notification",e.jsx(m,{message:"Transaction changed successfully!"})),300)):(a(v.id,v,!0),i(),setTimeout(()=>c("Notification",e.jsx(m,{message:"Transaction added successfully!"})),300))}catch{c("Error",e.jsx(m,{message:"Something went wrong!"}))}},p=(l,h)=>{const x=h.replace(/[^0-9.]/g,"").replace(/(\..*)\./g,"$1");u({...r,location:{lat:l==="lat"?x:r.location?.lat??"",lng:l==="lng"?x:r.location?.lng??""}})};return e.jsx("div",{className:"bg-[var(--color-card)] rounded-[10px] p-[20px] mx-auto",children:e.jsxs("form",{className:"flex flex-col gap-5",onSubmit:d,children:[e.jsxs("div",{className:"flex items-center gap-5 max-[500px]:flex-col max-[500px]:items-stretch max-[500px]:gap-3",children:[e.jsx("label",{className:"text-[var(--color-text)] text-[20px] font-semibold min-w-30",htmlFor:"location",children:"Title:"}),e.jsx("input",{type:"text",id:"title",value:r.title,onChange:l=>u({...r,title:l.target.value}),className:"bg-[var(--color-input)] rounded-[10px] p-[10px] w-full border-1 border-[var(--color-fixed-text)] text-[var(--color-text)] transitioned hover:border-[var(--color-hover)]"})]}),e.jsxs("div",{className:"flex items-center gap-5 max-[500px]:flex-col max-[500px]:items-stretch max-[500px]:gap-3",children:[e.jsx("label",{className:"text-[var(--color-text)] text-[20px] font-semibold min-w-30",htmlFor:"date",children:"Date:"}),e.jsx("input",{type:"datetime-local",value:S(new Date(r.date)),onChange:l=>u({...r,date:new Date(l.target.value).toISOString()}),id:"date",className:"bg-[var(--color-input)] rounded-[10px] p-[10px] w-full border-1 border-[var(--color-fixed-text)] text-[var(--color-text)] transitioned hover:border-[var(--color-hover)]"})]}),e.jsxs("div",{className:"flex items-center gap-5 max-[500px]:flex-col max-[500px]:items-stretch max-[500px]:gap-3",children:[e.jsx("label",{className:"text-[var(--color-text)] text-[20px] font-semibold min-w-30",htmlFor:"amount",children:"Amount:"}),e.jsx("input",{type:"text",id:"amount",value:r.amount,onChange:l=>u({...r,amount:D(l.target.value)}),className:"bg-[var(--color-input)] rounded-[10px] p-[10px] w-full border-1 border-[var(--color-fixed-text)] text-[var(--color-text)] transitioned hover:border-[var(--color-hover)]"})]}),e.jsxs("div",{className:"flex items-center gap-5 max-[500px]:flex-col max-[500px]:items-stretch max-[500px]:gap-3",children:[e.jsx("label",{htmlFor:"locationLat",className:"text-[var(--color-text)] text-[20px] font-semibold min-w-30",children:"Latitude:"}),e.jsx("input",{type:"text",id:"locationLat",placeholder:"23.456",value:r.location?.lat,onChange:l=>p("lat",l.target.value),className:"bg-[var(--color-input)] rounded-[10px] p-[10px] w-full border-1 border-[var(--color-fixed-text)] text-[var(--color-text)] transitioned hover:border-[var(--color-hover)]"})]}),e.jsxs("div",{className:"flex items-center gap-5 max-[500px]:flex-col max-[500px]:items-stretch max-[500px]:gap-3",children:[e.jsx("label",{htmlFor:"locationLng",className:"text-[var(--color-text)] text-[20px] font-semibold min-w-30",children:"Longitude:"}),e.jsx("input",{type:"text",id:"locationLng",placeholder:"23.456",value:r.location?.lng,onChange:l=>p("lng",l.target.value),className:"bg-[var(--color-input)] rounded-[10px] p-[10px] w-full border-1 border-[var(--color-fixed-text)] text-[var(--color-text)] transitioned hover:border-[var(--color-hover)]"})]}),e.jsxs("div",{className:"flex gap-7 items-center justify-center max-[500px]:flex-col max-[500px]:items-stretch max-[500px]:gap-3",children:[e.jsxs("label",{className:"text-[var(--color-text)] text-[20px] font-semibold",children:[e.jsx("input",{className:"mr-3",type:"radio",name:"transactionType",checked:r.isIncome,onChange:()=>u({...r,isIncome:!0})}),"Income"]}),e.jsxs("label",{className:"text-[var(--color-text)] text-[20px] font-semibold",children:[e.jsx("input",{className:"mr-3",type:"radio",name:"transactionType",checked:!r.isIncome,onChange:()=>u({...r,isIncome:!1})}),"Outcome"]})]}),e.jsx("button",{type:"submit",className:"bg-[var(--color-hover)] text-[var(--color-fixed)] rounded-[10px] p-[10px] w-full hover:bg-[var(--color-hover-reverse)] hover:text-[var(--color-hover)] transitioned cursor-pointer",children:"Change"})]})})}function O({id:t}){const{open:a,close:n}=b(),{deleteDataById:o}=f(),c=()=>{o(t),n(),setTimeout(()=>a("Notification",e.jsx(m,{message:"Transaction deleted successfully!"})),300)};return e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col p-3 justify-center items-center transitioned text-[var(--color-text)] text-2xl",children:[e.jsx("h1",{children:"Are you sure you want to delete this transaction?"}),e.jsxs("div",{className:"flex gap-3 justify-center items-center mt-[30px]",children:[e.jsx("button",{onClick:c,className:"px-3 py-2 cursor-pointer bg-[var(--bg-red)] rounded transitioned hover:bg-transparent border-2 border-[var(--bg-red)]",children:"Delete"}),e.jsx("button",{onClick:n,className:"px-3 py-2 cursor-pointer bg-[var(--bg-green)] rounded transitioned hover:bg-transparent border-2 border-[var(--bg-green)] ",children:"Cancel"})]})]})})}function N({data:t}){const{open:a}=b(),n=c=>()=>a("Change transaction",e.jsx(w,{id:c})),o=c=>()=>a("Delete transaction",e.jsx(O,{id:c}));return e.jsxs("div",{className:"grid grid-cols-8 items-center gap-4 p-3 rounded border border-[var(--color-fixed-text)] text-[var(--color-text)] transitioned roboto text-[18px] max-[1300px]:grid-cols-7 max-[1000px]:grid-cols-6 max-[970px]:grid-cols-3 max-[450px]:grid-cols-2",children:[e.jsx("span",{className:"justify-self-center px-2 truncate break-all whitespace-normal text-center",children:t.title}),e.jsxs("span",{className:"justify-self-center px-2 font-semibold",children:["$",t.amount.toFixed(2)]}),e.jsx("span",{className:`justify-self-center py-2 px-5 text-sm rounded-xl text-gray-40 ${t.isIncome?"bg-[var(--bg-green)]":"bg-[var(--bg-red)]"}`,children:t.isIncome?"Income":"Outcome"}),e.jsx("span",{className:"col-span-2 max-[1000px]:col-span-1 justify-self-center px-2 break-words whitespace-normal text-center",children:`${new Date(t.date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})} ${new Date(t.date).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})}`}),e.jsx("span",{className:"text-center col-span-2 max-[1300px]:col-span-1 justify-self-center px-2 break-words whitespace-normal",children:t.location?`${t.location.lat.toFixed(3)}, ${t.location.lng.toFixed(3)}`:"No location"}),e.jsxs("span",{className:"flex gap-3 max-[1200px]:flex-col max-[1200px]:justify-self-center max-[1200px]:gap-1 max-[970px]:flex-row",children:[e.jsx("button",{onClick:n(t.id),className:"rotate-[45deg] w-14 h-14 justify-self-center cursor-pointer p-1 hover:text-[var(--color-hover)] rounded transitioned hover:scale-110",children:e.jsx(L,{})}),e.jsx("button",{onClick:o(t.id),className:"w-14 h-14 justify-self-center cursor-pointer p-1 hover:text-[var(--color-hover)] rounded transitioned hover:scale-110",children:e.jsx(z,{})})]})]})}const B=({searchQuery:t,setDebouncedSearchQuery:a})=>{const[n,o]=s.useState(t);s.useEffect(()=>{const i=setTimeout(()=>{a(n)},500);return()=>clearTimeout(i)},[n,a]);const c=i=>{o(i.target.value)};return e.jsx("input",{type:"text",placeholder:"Search",value:n,onChange:c,className:"bg-[var(--color-card)] rounded-[10px] p-[10px] w-[300px] border-1 border-[var(--color-fixed-text)] text-[var(--color-text)] transitioned hover:border-[var(--color-hover)] text-[16px] font-semibold"})};function R(t){const a=s.useRef(()=>{});return s.useCallback(n=>{const o=new IntersectionObserver(c=>{c.forEach(i=>{i.isIntersecting&&t()})});n?(o.observe(n),a.current=()=>o.disconnect()):o.disconnect()},[])}function Q(t=10){const{user:a}=f(),{data:n,isLoading:o,error:c,fetchNextPage:i,hasNextPage:r,isFetchingNextPage:u}=T({queryKey:["infiniteUserData"],enabled:!!a?.nickname&&!!a?.password,staleTime:1/0,queryFn:async({pageParam:d=1})=>{if(!a?.nickname||!a.password)throw new Error("User not logged in");return E(a.nickname,a.password,d,t)},getNextPageParam:(d,p)=>{if(!(!d.data||d.data.length<t))return p.length+1},initialPageParam:1,select:d=>d.pages.flatMap(p=>p.data)});return{data:n,isLoading:o,error:c,fetchNextPage:i,hasNextPage:r,isFetchingNextPage:u}}function $(){const{user:t}=f(),[a]=s.useState(""),[n,o]=s.useState(""),{fetchNextPage:c,data:i,isFetchingNextPage:r,hasNextPage:u}=Q(),d=R(()=>{c()}),p=M(t.data??[],n),{open:l}=b(),h=()=>()=>l("Add transaction",e.jsx(w,{}));return t.nickname===null?e.jsx(m,{message:"You are not logged in. Please log in to see your transactions."}):e.jsxs("section",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between max-[970px]:flex-col items-center gap-6 mb-[27px]",children:[e.jsx("h1",{className:"text-[var(--color-title)] text-[32px] font-semibold",children:"Transactions"}),e.jsxs("div",{className:"flex gap-3 max-[400px]:flex-col justify-center",children:[e.jsx(B,{searchQuery:a,setDebouncedSearchQuery:o}),e.jsx("button",{onClick:h(),className:"bg-[var(--color-card)] rounded-[10px] p-[10px] text-[var(--color-text)] border-1 border-[var(--color-fixed-text)] transitioned cursor-pointer hover:border-[var(--color-hover)] hover:text-[var(--color-hover)] hover:scale-95 text-[16px] font-bold",children:"Add new"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[t.nickname&&!n&&i&&e.jsxs(e.Fragment,{children:[i.map(x=>x&&e.jsx(N,{data:x},x.id)),i?.length>0&&e.jsx("div",{ref:d}),r&&e.jsx(m,{message:"Loading..."}),!u&&e.jsx(m,{message:"No more transactions"})]}),n&&(p?p.map(x=>e.jsx(N,{data:x},x.id)):e.jsx(m,{message:"No transactions"}))]})]})}export{$ as Transactions};
