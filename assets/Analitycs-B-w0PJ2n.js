import{r as x,j as e,i as b,h as N,a as A,k as D,d as w,u as I,l as S,q as R,S as f,g as h,N as _,m as y}from"./index-BMILiYWd.js";import{t as g,s as v}from"./components-DlQtaEQy.js";import{u as T}from"./useTransactions-BK1OJrpO.js";function L({text:t,id:n}){const[s,o]=x.useState(""),r=x.useRef(null);return x.useEffect(()=>{const i=Array.from(t??"");o("");let l=!1;async function m(){for(let c=0;c<i.length&&!l;c++)o(d=>d+i[c]),await new Promise(d=>{r.current=window.setTimeout(d,20)})}return m(),()=>{l=!0,r.current!==null&&clearTimeout(r.current)}},[t,n]),e.jsx(e.Fragment,{children:s})}function k({children:t}){return b.createPortal(t,document.body)}const E=async({data:t,prompt:n,model:s="openai/gpt-oss-120b:cerebras"})=>N(A.post("/ai",{data:t,prompt:"Проаналізуй промпт та дані та дай конкретну відповідь на запитання на тій мові яка буде далі в промпті (якщо англ — то на англ очікую відповідь). Ще НЕ роби НІЯКИХ ТАБЛИЦЬ чи виділень тексту (жирним чи іншим) чи формул - відповідь коротким абзацом тексту. Дозволяються смайли, небагато. Далі дані для аналізу = "+n,model:s}),D);function C(){const{user:t}=w(),n=["AI_History",t?.id],{data:s=[]}=I({queryKey:n,queryFn:()=>{const r=localStorage.getItem(`AI_history_${t?.id}`);return r?JSON.parse(r):[]},enabled:!!t,staleTime:1/0}),o=S({mutationFn:async r=>({...await E(r),getted_at:new Date,prompt:r.prompt,id:crypto.randomUUID()}),onSuccess:r=>{R.setQueryData(n,(i=[])=>{const l=[r,...i];return localStorage.setItem(`AI_history_${t?.id}`,JSON.stringify(l)),l})}});return{history:s,isLoading:o.isPending,getResponse:o.mutate}}function P(){const[t,n]=x.useState(""),{user:s,isLoading:o}=w(),{data:r,isLoading:i,error:l}=T({userId:s?.id}),{history:m,isLoading:c,getResponse:d}=C(),p=x.useCallback(()=>{if(!t||!r?.data.length)return;const a=r.data;d({prompt:t,data:{transactions:a},model:"openai/gpt-oss-120b:cerebras"}),n("")},[t,r,d]);return x.useEffect(()=>{const a=u=>{u.key==="Enter"&&(u.preventDefault(),p())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[p]),o||i?e.jsx(f,{}):s?l?e.jsx(h,{message:"Something went wrong..."}):r?e.jsx("section",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsx("h1",{className:"text-[var(--color-title)] transitioned text-[32px] font-semibold mb-6",children:"Analytics"}),c&&e.jsx("div",{className:"h-30 w-30 overflow-hidden flex justify-center items-center mx-auto",children:e.jsx(f,{})}),m.map((a,u)=>{const j=Math.abs(new Date().getTime()-new Date(a.getted_at).getTime())<6e4;return e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:u*.1},children:[e.jsxs("div",{className:"mt-6 text-[var(--color-text)] px-5 py-2 border-1 border-[var(--color-fixed-text)] rounded max-w-[70%] max-sm:max-w-full w-fit items-end ml-auto flex flex-col justify-end",children:[e.jsxs("div",{className:"flex flex-row-reverse items-center gap-3",children:[s.photo_url&&e.jsx("img",{src:s.photo_url,className:"w-8 h-8 rounded-full",alt:s.name||"User"}),e.jsx("div",{children:a.prompt})]}),e.jsx("div",{className:"w-full italic text-right mt-3 text-[var(--color-placeholder)]",children:g(a.getted_at,!0)})]}),e.jsxs("div",{className:"mt-6 text-[var(--color-text)] px-5 py-2 border-1 border-[var(--color-fixed-text)] rounded max-w-[70%] max-sm:max-w-full",children:[u===0&&j?e.jsx(L,{id:a.id,text:v(a.result)}):e.jsx(e.Fragment,{children:v(a.result)}),e.jsx("div",{className:"w-full italic text-right mt-3 text-[var(--color-placeholder)]",children:g(a.getted_at,!0)})]})]},u)}),e.jsx(k,{children:e.jsx(y.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},transition:{duration:.4,ease:"easeOut"},className:`fixed z-3 bottom-5 left-[320px] w-[calc(100%-340px)] max-md:left-5 max-md:w-[calc(100%-40px)]
                        bg-[var(--color-card)]  rounded-2xl border-2 border-[var(--color-fixed-text)]
                        shadow-lg`,children:e.jsxs("div",{className:"flex gap-6 my-2 mx-3 justify-between items-center",children:[e.jsx("textarea",{name:"prompt",value:t,onChange:a=>n(a.target.value),placeholder:"Ask me anything...",id:"prompt",className:`w-full max-h-48 h-12 rounded-[5px] p-3 placeholder:text-[var(--color-placeholder)]
                                text-[var(--color-text)] scrollable resize-none transitioned text-[16px] font-semibold
                                focus:outline-none`}),e.jsx("button",{onClick:p,type:"button",disabled:c,className:`w-[120px] h-12 border-1 border-[var(--color-fixed-text)] rounded-[10px] p-3
                                text-[var(--color-text)] cursor-pointer transitioned
                                hover:bg-[var(--color-fixed-text)] hover:text-[var(--color-card)]
                                text-[16px] font-semibold`,children:"Analyze"})]})})})]})}):e.jsx(_,{}):e.jsx(h,{message:"You are not logged in..."})}export{P as Analitycs};
